[back](../../20251117定期月總結.md)

# 基本組合

時間窗口 \[+分布加權\] \[+多項式回歸\]

|是否加權|是否多項式擬合|方法名稱|
|---|---|---|
|否|否|移動平均 (Moving Average)|
|✅|否|核回歸 (Kernel Regression) |
|否|✅|Savitzky–Golay 濾波器|
|✅|✅|LOESS / LOWESS（局部加權回歸）|


# 高斯權重（Gaussian Weight）

## 常態分佈

$$
p(x) = \frac{1}{\sqrt{2\pi}\sigma}
       \exp\!\left(-\frac{(x - \mu)^2}{2\sigma^2}\right)
$$

$$
\begin{aligned}
\mu &: \text{中心點} \\
\sigma &: \text{標準差}
\end{aligned}
$$

> 注意 最外層 2pi 因為是權重所以最終會被除掉

$$ w = \exp\left(-\frac{d^2}{2\sigma^2}\right)$$

- 當距離 d→0，則 w→1
- 當距離 d 變大，則 w→0

這個權重函數的形狀是一個高斯函數（Gaussian function）：

## 簡化1

> 合併 sigma與常數項

$$w(t_0, t) = \exp\!\left(-\frac{d^2}{h^2}\right)$$

其中：

$$h^2 = 2\sigma^2
\quad \Rightarrow \quad
\sigma = \frac{h}{\sqrt{2}}
$$
## 簡化2

> 先將資料正規化 ( sigma=1)

$$ w = \exp\left(-\frac{\bar{d}^2}{2}\right)$$

```python
def gaussian_kernel(d):
    return np.exp(-0.5 * d**2) / np.sqrt(2 * np.pi)
```
---

## 核回歸

> 根據「距離差」決定權重：越近 → 權重越大

$$u = \frac{x_i - x_0}{h}
$$

$$
K\!\left( u \right) = \exp\!\left(-\frac{u^2}{2}\right)
$$
- 若 ∣xi−x0∣≪h，則 u≈0，→ 權重最大；
- 若 ∣xi−x0∣≫h，則 u 大，→ 權重趨近 0。

## 值域濾波

> 根據「數值差」決定權重：差距愈小 → 權重越大

x(t)：時間序列（或影像）的單一點值

$$
u = \frac{x_i - x_0}{\sigma_r}
$$

$$ w(t_0, t) = \exp\left(-\frac{u^2}{2}\right) $$

$$
\begin{aligned}
x_i &: \text{xi對應的y值} \\
x_0 &: \text{x0對應的y值}
\end{aligned}
$$

## 雙邊濾波

> 根據「距離差」與「數值差」決定權重

$$
w(i, 0)
= \exp\!\left(-\frac{|p_i - p_0|^2}{2\sigma_s^2}\right)
  \exp\!\left(-\frac{|I_i - I_0|^2}{2\sigma_r^2}\right)
$$

$$
w(i, 0) =
    \displaystyle \sum_{(u,v) \in \Omega}
    \exp\left(-\frac{(x - u)^2 + (y - v)^2}{2\sigma_s^2}\right)
    \exp\left(-\frac{|I(x, y) - I(u, v)|^2}{2\sigma_r^2}\right)
$$

|符號|意義|對應例子|
|---|---|---|
|(p_i, p_0)|位置（x、y 座標或時間索引）|圖像中的 pixel 位置、時間點|
|(x_i, x_0)|訊號值（亮度、強度、y 值）|圖像的亮度值、序列的數值|
|(\sigma_s)|空間尺度|控制鄰域範圍|
|(\sigma_r)|值域尺度|控制「值差」對權重的影響|

---

## 非局部平均 NLM

> 根據「數值差」決定權重：差距愈小 → 權重越大
> 值域濾波+patch向量

+ 改用patch向量
+ 數值差改用兩個 patch 向量的差異

|參數|控制的面向|對應的意義|類比|
|---|---|---|---|
|k|空間結構範圍|每個 patch 的大小|看多寬的「局部區域」|
|h|相似度尺度|patch 差異轉成權重的平滑度|高斯函數的「σ」|

$$
\mathbf{x}_t =
\begin{bmatrix}
x(t - k) \\
x(t - k + 1) \\
\vdots \\
x(t + k)
\end{bmatrix}
$$

$$
d^2(t_0, t)
= \|\mathbf{x}_{t_0} - \mathbf{x}_t\|^2
= \sum_{i=-k}^{k} [x(t_0+i) - x(t+i)]^2
$$

$$
w(t_0, t)
= \exp\!\left(-\frac{\|\mathbf{x}_{t_0} - \mathbf{x}_t\|^2}{2h^2}\right)
$$

### 加入空間
> 根據「距離差」與「數值差」決定權重

$$
w(t_0, t)
= \exp\!\left(-\frac{|p_i - p_0|^2}{2\sigma_s^2}\right)\exp\!\left(-\frac{\|\mathbf{x}_{t_0} - \mathbf{x}_t\|^2}{2h^2}\right)
$$



